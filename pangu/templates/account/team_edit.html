{% extends "base.html" %}
{% block content %}
{% from "forms/macros.html" import render_field %}

<link rel="stylesheet" href="{{ url_for('static', filename='mmGrid/src/mmGrid.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='mmGrid/mmPaginator.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='mmGrid/src/mmTreeGrid.css') }}">

<script src="{{ url_for('static', filename='mmGrid/src/mmGrid.js') }}"></script>
<script src="{{ url_for('static', filename='mmGrid/src/mmPaginator.js') }}"></script>
<script src="{{ url_for('static', filename='mmGrid/src/mmTreeGrid.js') }}"></script>

<div class="content pure-g-r">
    <div class="pure-u-1-2">
        <form class="pure-form pure-form-aligned" method="post">
            {{ form.csrf_token }}
            <fieldset>
                {{ render_field(form.name, class="pure-input-1-3", placeholder="运维组") }}
                {{ render_field(form.leader_id, class="pure-input-1-4") }}
                {{ render_field(form.notes, rows='10', class="pure-input-2-3") }}
    </div>
    <div class="pure-u-1-2" style="margin-top:5px">
        <label><b>权限</b></label>
        <table id="role_tree"></table>
    </div>
    <div class="pure-u-1-2" style="margin-left:146px">
        <input type="submit" class="pure-button pure-button-primary" value="提交">
        <a class="pure-button pure-button-success" href="{{ url_for('account.team_list') }}">返回</a>
    </div>
            </fieldset>
        </form>
</div>

<script type="text/javascript">
$(function(){
    var _id = 20;
    function get_id(){ _id ++; return _id}
        var items = [
            {name:'需求阶段', 'begin_date':'<input type="checkbox" name="2_list" value="2">', 'end_date':'<input type="checkbox" name="2_add" value="x">', 'pre_task':'', type:'2', id:1}
            , {name:'需求分析', 'begin_date':'<input type="checkbox" name="2_list" value="2">', 'end_date':'<input type="checkbox" name="2_add" value="x">', 'pre_task':'', type:'2', _parent:1, id:2}
            , {name:'需求分析评审', 'begin_date':'<input type="checkbox" name="2_list" value="2">', 'end_date':'<input type="checkbox" name="2_add" value="x">', 'pre_task':'', type:'1', _parent:1, id:3}
            , {name:'开发阶段', 'begin_date':'<input type="checkbox" name="2_list" value="2">', 'end_date':'<input type="checkbox" name="2_add" value="x">', 'pre_task':'', type:'2', id:4}
            , {name:'概要设计', 'begin_date':'<input type="checkbox" name="2_list" value="2">', 'end_date':'<input type="checkbox" name="2_add" value="x">', 'pre_task':'', type:'2', _parent:4, id:5}
            , {name:'详细设计', 'begin_date':'<input type="checkbox" name="2_list" value="2">', 'end_date':'<input type="checkbox" name="2_add" value="x">', 'pre_task':'', type:'2', _parent:4, id:6}
            , {name:'开发', 'begin_date':'<input type="checkbox" name="2_list" value="2">', 'end_date':'<input type="checkbox" name="2_add" value="x">', 'pre_task':'', type:'2', _parent:4, id:7}
            , {name:'编码', 'begin_date':'<input type="checkbox" name="2_list" value="2">', 'end_date':'<input type="checkbox" name="2_add" value="x">', 'pre_task':'', type:'2', _parent:7, id:8}
            , {name:'单元测试', 'begin_date':'<input type="checkbox" name="2_list" value="2">', 'end_date':'<input type="checkbox" name="2_add" value="x">', 'pre_task':'', type:'2', _parent:7, id:9}
        ];

        var cols = [
            {title:'#', name:'id', width:20, align:'center', lockWidth:true},
            {title:'菜单', name:'name', width:240, lockDisplay:true},
            {title:'浏览', name:'begin_date', align:'center', width:50},
            {title:'增加', name:'end_date', align:'center', width:50},
            {title:'编辑', name:'begin_date', align:'center', width:50},
            {title:'删除', name:'end_date', align:'center', width:50}
        ];

        $('#role_tree').mmGrid({
                    height: 550
                    , width: 550   
                    , readonly: true
                    , cols: cols
                    , method: 'get'
                    , items: items
                    , checkCol: false
                    , fitColWidth: false
                    , nowrap: true
                    , fullWidthRows: true
                    , indexCol: false
                    , treeColumn: 'name'  //第几列是树结点
                    , idField: 'id'  //缺省就是使用id
                    , showBackboard: false
                    , clickableNodeNames: true  //单击结点名称自动切换展示，折叠状态
        });

        function item_tree(){
            var data = [
                {name:'任务1', 'begin_date':'2013-1-5', 'end_date':'2013-2-1', 'pre_task':'', type:'2', _isParent:true, id:get_id(),
                        _children:[
                            {name:'需求分析1', 'begin_date':'2013-1-5', 'end_date':'2013-2-1', 'pre_task':'', type:'2', id:get_id()}
                            , {name:'需求分析评审1', 'begin_date':'2013-1-5', 'end_date':'2013-2-1', 'pre_task':'', type:'1', id:get_id()}
                        ]}
                , {name:'任务2', 'begin_date':'2013-1-5', 'end_date':'2013-2-1', 'pre_task':'', type:'2', _isParent:true, id:get_id(),
                        _children:[
                            {name:'概要设计2', 'begin_date':'2013-1-5', 'end_date':'2013-2-1', 'pre_task':'', type:'2', id:get_id()}
                            , {name:'详细设计2', 'begin_date':'2013-1-5', 'end_date':'2013-2-1', 'pre_task':'', type:'2', id:get_id()}
                            , {name:'开发2', 'begin_date':'2013-1-5', 'end_date':'2013-2-1', 'pre_task':'', type:'2', id:get_id()}
                ]}
            ]
            return data;
        }
});
</script>

{% endblock %}